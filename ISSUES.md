# THIS IS A GUIDE TO DOCUMENT THE KNOWN PROBLEMS IN THE APP.

## I WILL DOCUMENT KNOW PROBLEMS BELOW THAT I FIND AND NEED FIXING. ALWAYS REFER TO IT MARK COMPLETE ONCE A FIX IS APPLIED AND MARK [X] FOR COMPLETED

## ISSUES:
- [X] BULK CIRCUIT ADDITION DOES NOT WORK PROPERLY. WHEN CIRCUITS ARE ADDED IN BULK THEY DON'T SHOW IN THE PANEL SCHEDULE THEY WERE ADDED. SOMETIMES IT SHOWS THEY CIRCUIT # IN () CORRECT AND THE LOAD BUT THE CIRCUITS DON'T SHOW. **FIXED 2025-12-02** - Added optimistic updates to useCircuits hook + database migration for unique constraint. See CIRCUIT_DISPLAY_FIX.md
- [X] WHEN ADDING A CIRCUIT MANUALLY THE SAME HAPPENS. WHEN YOU ADD THE FIRST ONE IT WORKS BUT THEN THE SECOND ONE DOES NOT WORK AND IT SHOWS THE TOTAL LOAD TOO. **FIXED 2025-12-02** - Same fix as above. Circuits now appear instantly with optimistic updates.
- [X] CIRCUITS WITH 2 OR 3 PONES SHOULD BE ABLE TO OCCUPY 2 OR 3 POLES TOGETHER IN THE PANEL SCHEDULE. THERE IS NO POSIBILITY OF REMOVING CIRCUITS INDIVIDUALLY, ONLY EDITING THE DESCRIPTION IN THE PANEL SCHEDULE. I NEED TO BE ABLE TO DELETE THEM COMPLETELY AND MODIFY LOAD IF NECESSARY(NOT ONLY THE NAME) **FIXED 2025-12-02** - Multi-pole circuits now show visual badges (2P/3P) and occupy multiple slots with continuation indicators. Added delete button (trash icon on hover) for all circuits. Added load_watts editing capability. See PANEL_SCHEDULE_ENHANCEMENTS.md
- [X] I NOTICE THE FOLLOWING: WHEN ADDING ONE PANEL TO THE MDP (SAY 'LP') I CAN'T ADD ANOTHER PANEL TO THAT LP DOWNSTREAM IT GETS ADDED IN THE LIST BUT NOT IN THE RISER DIAGRAM. **FIXED 2025-12-03** - Implemented recursive rendering for cascading panel hierarchies. One-line diagram now shows unlimited depth: MDP → Panel → Subpanel → etc., and transformers at any level with their downstream panels. See CASCADING_HIERARCHY_FIX.md 
- [X] PROGRAM IS ALLOWING TO ADD PANELS OR ELEMENTS THAT ARE NOT COMPATIBLE. FOR EXAMPLE IT ALLOWS YOU TO ADD A 208V 3PH PANEL DIRECTLY TO A 480V 3PH PANEL. THIS SHOUDL NOT BE ALLOWED OVERALL SYSTEMS SHOULD BE COMPATIBLE IN ALL THE POSSIBLE COMBINATIONS. YOU CAN'T CONNECT A 3PHASE PANEL TO A SINGLE PHASE PANEL ETC. EVALUATE WITH THE ENGINEER AGENT ALL THE POSSIBLE COMBINATIONS. **FIXED 2025-12-02** - Implemented comprehensive voltage/phase compatibility validation. Blocks dangerous connections (e.g., 480V→208V without transformer), warns about unusual configurations (e.g., high-leg delta), allows valid connections (same voltage/phase, line-to-neutral derivatives). See VOLTAGE_PHASE_VALIDATION.md 
- [X] ONCE THE FEEDER IS CREATED BETWEEN 2 PANELS IT SHOULD ALSO UPDATE IF THE LOAD IS CHANGED IN THE PANEL LATER ON AND IT IS NOT DOING IT. OR AT LEATS A NOTIFICATION SAYING THAT THE LOAD WAS UPDATED. **FIXED 2025-12-04** - Added `feederLoadSync.ts` service to detect stale feeders. FeederManager now shows a warning banner when panel loads change with one-click recalculation. Each feeder card shows an "Outdated" badge with load difference percentage.
- [X] THERE SHOULD BE NO WAY OF CREATING A FEEDER FOR PANELS THAT ARE NOT CONNECTED. FOR EXAMPLE IF I CREATE PANEL LP(480V) FED FROM MDP(480V) AND THEN CREATE A PP(208V) FED THROUGH A XFMR TO MDP. THE PROGRAM SHOULD NOT BE ABLE TO CREATE A FEEDER FROM LP TO PP PANELS. CONSULT THE ENGINEER AGEN FOR THE BEST RESULT. **FIXED 2025-12-04** - Added `panelConnectivityValidation.ts` service. Feeder form now validates panel connectivity before allowing save. Panels on different voltage segments (separated by transformers) cannot have direct feeders. Shows clear error messages explaining why connection is invalid.
- [X] PANEL MDP SHOULD BE ABLE TO BE ELIMINATED ONCE CREATED. **FIXED 2025-12-02** - MDP can now be deleted with strong warning message (no longer blocked). User must confirm understanding that deleting the only MDP removes service entrance. See PANEL_SCHEDULE_ENHANCEMENTS.md
- [X] WHEN CREATING A TRANSFORMER OR ADDING A PANEL CONNECTED TO ANOTHER PANEL IT CREATES BUT IT DOES NOT SHOW ON THE ONE LINE DIAGRAM. IT SEEMS THE LIMIT IS ONE PANEL AFTER THE BUS FROM THE MDP. **FIXED 2025-12-03** - Same fix as Issue #4 above. Recursive rendering now supports transformers at any panel level (not just MDP), with proper cascading to downstream panels. See CASCADING_HIERARCHY_FIX.md
- [X] WHEN CONNECTING ONE PANEL TO ANOTHER TROUGH THE ONE-LINE. THE LOAD FROM THE PANEL DOWNSTREAM SHOULD BE TRANSLATED UPSTREAM TO THE FEEDING PANEL. EVALUATE WHICH LOAD SHOULD BE TRANSLATED TO THE FEEDING PANEL(DEMAND OR CONNECTED) BASED ON CODE REQUIREMENTS. THE PANEL SHOULD CONNECT TO THE AVAILABLE CIRCUITS ON THE PANEL. **FIXED 2025-12-04** - Added `upstreamLoadAggregation.ts` service implementing NEC 220.40. **CORRECTED 2025-12-04** - Demand factors now applied to SYSTEM-WIDE totals (not per-panel). Motors: only ONE largest at 125%. Receptacles: first 10kVA system-wide at 100%. Lighting: uses occupancyType (dwelling=35% factor, commercial=100%). Uses existing Table 220.42 data.
- [X] GROUNDING AND BONDING CHECKBOXES DON'T PERSIST / DON'T WORK. **FIXED 2025-12-04** - Created `useGrounding` hook for database persistence to the `grounding_details` table. Checkboxes now save with optimistic updates and real-time sync. Added NEC 250 improvements: auto GEC sizing recommendations, EGC sizing tables (250.66, 250.122), compliance status checking, tabbed UI for electrodes/bonding/sizing.
- [X] WHEN CREATING A RESIDENTIAL SYSTEM 120/240v. iT IS PERMITTED TO ADD CIRCUITS 3P CAUSING ERRORS. IT IS ALSO PERMITTED ADDING MDP THAT IS DIFFERENT FROM A RESIDENTIOAL SYSTEM LIKE 208 3PH **FIXED 2025-12-05** - Added validation to block 3-pole circuits in single-phase panels (residential). Added validation to enforce 120/240V single-phase for residential project MDPs. 3P option now disabled in pole dropdowns when panel is single-phase. Clear error messages explain the constraint.
- [X] MAIN PANEL CAN'T BE EDITED OR CHANGED AFTER CREATED. **FIXED 2025-12-05** - Added inline edit form for all panels including MDP in the Panels List. Can now edit: name, bus rating, main breaker, location, voltage, and phase (with residential project constraints). Warns about downstream panel impact when changing voltage/phase.

##### NOTE: NOTIFY THE USER IF A MODIFICATION OF THE SUPABASE IS NEEDED WHEN FIXING ANY PROBLEM OR DOING ANY MODIFICATION. THE USER IS USING THE *.SQL FILES FROM THE REPO LOCATION. ALWAYS CONSULT THE AGENTS TO MAP THE PROBLEM AND PERFORM THE BEST POSSIBLE SOLUTION BEFORE APPLYING THE FIX.